<!DOCTYPE html>
<html lang="en">

<head>
    <title>UniBuddy - Habit Tracker</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" href="assets/img/apple-icon.png">
    <link rel="shortcut icon" type="image/x-icon" href="assets/img/favicon.ico">
    <!-- Load Require CSS -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font CSS -->
    <link href="assets/css/boxicon.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <!-- Load Template CSS -->
    <link rel="stylesheet" href="assets/css/templatemo.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/custom.css">
    <style>
        :root {
            --rich-black: #0D1B2A;
            --oxford-blue: #1B263B;
            --yinmn-blue: #415A77;
            --silver-lake-blue: #758BA9;
            --platinum: #E0E1DD;
        }
        body {
            background: var(--rich-black);
            color: var(--rich-black);
            font-family: 'Open Sans', sans-serif;
        }
        /* Navbar Customization */
        .navbar {
            background: var(--oxford-blue) !important;
            min-height: 48px;
            padding-top: 0.2rem;
            padding-bottom: 0.2rem;
            box-shadow: 0 2px 8px rgba(13,27,42,0.08);
        }
        .navbar-brand {
            font-family: 'Montserrat', 'Open Sans', sans-serif;
            font-weight: 700;
            font-size: 1.5rem;
            letter-spacing: 1px;
            color: var(--platinum) !important;
            display: flex;
            align-items: center;
        }
        .navbar-brand .logo-text-uni {
            color: var(--platinum);
        }
        .navbar-brand .logo-text-buddy {
            color: var(--silver-lake-blue);
        }
        .navbar-nav .nav-link {
            color: var(--platinum) !important;
            font-weight: 500;
            font-size: 1rem;
            padding-top: 0.2rem !important;
            padding-bottom: 0.2rem !important;
        }
        .navbar-nav .nav-link.active, .navbar-nav .nav-link:hover {
            color: var(--silver-lake-blue) !important;
            background: transparent !important;
        }
        .navbar-toggler {
            border: none;
        }
        .navbar .bx {
            color: var(--silver-lake-blue) !important;
        }
        /* Tracker Card */
        .tracker-box {
            border: 2px solid var(--yinmn-blue);
            border-radius: 8px;
            padding: 32px 24px;
            margin: 40px auto;
            max-width: 900px;
            background: var(--platinum);
            box-shadow: 0 4px 24px rgba(13,27,42,0.08);
        }
        .tracker-title {
            font-size: 2.2rem;
            font-weight: 900;
            letter-spacing: 2px;
            text-align: center;
            margin-bottom: 24px;
            color: var(--oxford-blue);
        }
        .form-inline > * {
            margin-right: 12px;
        }
        .form-control, .btn {
            border-radius: 6px;
        }
        .form-control:focus {
            border-color: var(--yinmn-blue);
            box-shadow: 0 0 0 2px var(--silver-lake-blue);
        }
        .btn-dark {
            background: var(--rich-black);
            border: none;
            color: var(--platinum);
        }
        .btn-dark:hover {
            background: var(--oxford-blue);
            color: var(--platinum);
        }
        .table th, .table td {
            text-align: center;
            vertical-align: middle;
        }
        .table thead th {
            border-bottom: 2px solid var(--yinmn-blue);
            background: var(--silver-lake-blue);
            color: var(--rich-black);
        }
        .table tbody td {
            border-top: 1px solid var(--silver-lake-blue);
            background: var(--platinum);
        }
        .habit-label {
            font-weight: 600;
            color: var(--yinmn-blue);
        }
        .summary-box {
            border-top: 2px solid var(--yinmn-blue);
            margin-top: 24px;
            padding-top: 16px;
            font-size: 1.1rem;
            color: var(--oxford-blue);
        }
        .streak-icon {
            font-size: 1.2em;
            margin-left: 4px;
            color: var(--yinmn-blue);
        }
        .checkbox-cell input[type="checkbox"] {
            transform: scale(1.2);
            accent-color: var(--yinmn-blue);
        }
        .month-select {
            min-width: 120px;
        }
        .user-input {
            min-width: 120px;
        }
        .add-habit-input {
            min-width: 160px;
        }
        .save-btn {
            margin-top: 10px;
            font-weight: 600;
        }
        .history-section {
            margin-top: 32px;
            background: var(--silver-lake-blue);
            border-radius: 8px;
            padding: 16px;
        }
        .history-title {
            font-weight: 700;
            color: var(--rich-black);
            margin-bottom: 12px;
        }
        .history-list {
            list-style: none;
            padding-left: 0;
        }
        .history-list li {
            margin-bottom: 8px;
            color: var(--oxford-blue);
        }
        @media (max-width: 768px) {
            .tracker-box {
                padding: 16px 4px;
            }
            .table-responsive {
                font-size: 0.95em;
            }
            .navbar-brand {
                font-size: 1.1rem;
            }
        }
    </style>
</head>

<body>
    <!-- Navigation Bar Start -->
    <nav id="main_nav" class="navbar navbar-expand-lg shadow">
        <div class="container d-flex justify-content-between align-items-center">
            <a class="navbar-brand h1" href="index.html">
                <i class='bx bx-book bx-sm' style="margin-right:6px;"></i>
                <span class="logo-text-uni">Uni</span><span class="logo-text-buddy">Buddy</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-toggler-success" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="align-self-center collapse navbar-collapse flex-fill  d-lg-flex justify-content-lg-between" id="navbar-toggler-success">
                <div class="flex-fill mx-xl-5 mb-2">
                    <ul class="nav navbar-nav d-flex justify-content-between mx-xl-5 text-center">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="about.html">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="work.html">Work</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="pricing.html">Pricing</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="HabitTracker.html">HabitTracker</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="contact.html">Contact</a>
                        </li>
                    </ul>
                </div>
                <div class="navbar align-self-center d-flex">
                    <a class="nav-link" href="#"><i class='bx bx-bell bx-sm bx-tada-hover'></i></a>
                    <a class="nav-link" href="#"><i class='bx bx-cog bx-sm'></i></a>
                    <a class="nav-link" href="#"><i class='bx bx-user-circle bx-sm'></i></a>
                </div>
            </div>
        </div>
    </nav>
    <!-- Navigation Bar End -->

    <div class="tracker-box shadow">
        <div class="mb-3 text-center">
            <span class="tracker-title"><b>HABIT TRACKER &#10024;</b></span>
        </div>
        <form id="habit-form" class="form-inline justify-content-center mb-4 flex-wrap">
            <input type="text" id="user-input" class="form-control user-input mb-2" placeholder="User" required>
            <input type="text" id="habit-input" class="form-control add-habit-input mb-2" placeholder="Add Habit" required>
            <select id="month-select" class="form-control month-select mb-2" required>
                <option value="" disabled selected>Month</option>
                <option value="1">January</option>
                <option value="2">February</option>
                <option value="3">March</option>
                <option value="4">April</option>
                <option value="5">May</option>
                <option value="6">June</option>
                <option value="7">July</option>
                <option value="8">August</option>
                <option value="9">September</option>
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
            </select>
            <button type="submit" class="btn btn-dark mb-2">Add Habit</button>
        </form>
        <div class="table-responsive">
            <table class="table table-bordered" id="habit-table">
                <thead>
                    <tr>
                        <th>Habit</th>
                        <!-- Days will be generated by JS -->
                    </tr>
                </thead>
                <tbody>
                    <!-- Habits will be generated by JS -->
                </tbody>
            </table>
        </div>
        <button id="save-btn" class="btn btn-dark save-btn">Save Progress</button>
        <div class="summary-box d-flex flex-wrap justify-content-between">
            <div id="completion-box">Completion %: <span id="completion-percent">0</span>%</div>
            <div id="streak-box">Monthly Streak: <span id="monthly-streak">0</span> <span class="streak-icon">&#9671;</span></div>
        </div>
        <div class="history-section">
            <div class="history-title">Saved Progress History</div>
            <ul id="history-list" class="history-list"></ul>
        </div>
    </div>
    <script>
        // --- State ---
        let habits = [];
        let user = '';
        let selectedMonth = new Date().getMonth() + 1; // Default to current month

        // --- Elements ---
        const habitForm = document.getElementById('habit-form');
        const userInput = document.getElementById('user-input');
        const habitInput = document.getElementById('habit-input');
        const monthSelect = document.getElementById('month-select');
        const habitTable = document.getElementById('habit-table');
        const completionPercent = document.getElementById('completion-percent');
        const monthlyStreak = document.getElementById('monthly-streak');
        const saveBtn = document.getElementById('save-btn');
        const historyList = document.getElementById('history-list');

        // --- Helpers ---
        function getDaysInMonth(month, year) {
            return new Date(year, month, 0).getDate();
        }

        function getStorageKey(user, month, year) {
            return `habitTracker_${user}_${month}_${year}`;
        }

        function getHistoryKey(user) {
            return `habitTrackerHistory_${user}`;
        }

        function saveHabits() {
            if (!user) return;
            const year = new Date().getFullYear();
            localStorage.setItem(getStorageKey(user, selectedMonth, year), JSON.stringify(habits));
        }

        function loadHabits() {
            if (!user) return [];
            const year = new Date().getFullYear();
            const data = localStorage.getItem(getStorageKey(user, selectedMonth, year));
            if (data) {
                try {
                    return JSON.parse(data);
                } catch {
                    return [];
                }
            }
            return [];
        }

        function saveProgressHistory() {
            if (!user) return;
            const year = new Date().getFullYear();
            const key = getHistoryKey(user);
            let history = JSON.parse(localStorage.getItem(key) || "[]");
            const entry = {
                month: selectedMonth,
                year: year,
                habits: JSON.parse(JSON.stringify(habits)),
                timestamp: new Date().toLocaleString()
            };
            // Remove previous entry for same month/year
            history = history.filter(h => !(h.month === selectedMonth && h.year === year));
            history.push(entry);
            localStorage.setItem(key, JSON.stringify(history));
            renderHistory();
        }

        function renderHistory() {
            if (!user) {
                historyList.innerHTML = "<li>Please enter a user name to view history.</li>";
                return;
            }
            const key = getHistoryKey(user);
            let history = JSON.parse(localStorage.getItem(key) || "[]");
            if (history.length === 0) {
                historyList.innerHTML = "<li>No saved progress yet.</li>";
                return;
            }
            history.sort((a, b) => b.year - a.year || b.month - a.month);
            historyList.innerHTML = "";
            history.forEach(entry => {
                const monthName = monthSelect.options[entry.month].text;
                let habitsSummary = entry.habits.map(h => `<b>${h.name}</b>: ${h.days.filter(Boolean).length}/${h.days.length} days`).join(", ");
                let li = document.createElement("li");
                li.innerHTML = `<span><b>${monthName} ${entry.year}</b> - Saved: ${entry.timestamp}<br>${habitsSummary}</span>
                <button class="btn btn-sm btn-dark" style="margin-left:8px;" onclick="loadHistoryProgress('${entry.month}','${entry.year}')">Load</button>`;
                historyList.appendChild(li);
            });
        }

        // Expose for button in history
        window.loadHistoryProgress = function(month, year) {
            if (!user) return;
            const key = getHistoryKey(user);
            let history = JSON.parse(localStorage.getItem(key) || "[]");
            let entry = history.find(h => h.month == month && h.year == year);
            if (entry) {
                selectedMonth = parseInt(month);
                monthSelect.value = selectedMonth;
                habits = JSON.parse(JSON.stringify(entry.habits));
                saveHabits();
                refreshUI();
            }
        };

        function renderTable() {
            const year = new Date().getFullYear();
            const days = getDaysInMonth(selectedMonth, year);

            // Render table header
            let theadRow = '<th>Habit</th>';
            for (let d = 1; d <= days; d++) {
                theadRow += `<th>${d}</th>`;
            }
            habitTable.querySelector('thead tr').innerHTML = theadRow;

            // Render table body
            let tbodyHtml = '';
            habits.forEach((habit, hIdx) => {
                tbodyHtml += `<tr><td class="habit-label">${habit.name}</td>`;
                for (let d = 1; d <= days; d++) {
                    tbodyHtml += `<td class="checkbox-cell">
                        <input type="checkbox" data-habit="${hIdx}" data-day="${d-1}" ${habit.days[d-1] ? 'checked' : ''}>
                    </td>`;
                }
                tbodyHtml += '</tr>';
            });
            habitTable.querySelector('tbody').innerHTML = tbodyHtml;
        }

        function updateStats() {
            let totalChecks = 0, totalBoxes = 0, maxStreak = 0;
            habits.forEach(habit => {
                let streak = 0, currentStreak = 0;
                habit.days.forEach(checked => {
                    totalBoxes++;
                    if (checked) {
                        totalChecks++;
                        currentStreak++;
                        if (currentStreak > streak) streak = currentStreak;
                    } else {
                        currentStreak = 0;
                    }
                });
                if (streak > maxStreak) maxStreak = streak;
            });
            completionPercent.textContent = totalBoxes ? Math.round((totalChecks / totalBoxes) * 100) : 0;
            monthlyStreak.textContent = maxStreak;
        }

        function refreshUI() {
            renderTable();
            updateStats();
            renderHistory();
        }

        // --- Event Listeners ---
        habitForm.addEventListener('submit', function(e) {
            e.preventDefault();
            user = userInput.value.trim();
            if (!user) {
                alert("Please enter a user name.");
                return;
            }
            const habitName = habitInput.value.trim();
            selectedMonth = parseInt(monthSelect.value) || (new Date().getMonth() + 1);
            if (!habitName) return;
            const year = new Date().getFullYear();
            const days = getDaysInMonth(selectedMonth, year);
            habits.push({ name: habitName, days: Array(days).fill(false) });
            habitInput.value = '';
            saveHabits();
            refreshUI();
        });

        monthSelect.addEventListener('change', function() {
            selectedMonth = parseInt(this.value);
            if (!user) return;
            habits = loadHabits();
            // If habits exist but days don't match, fix array length
            const year = new Date().getFullYear();
            const days = getDaysInMonth(selectedMonth, year);
            habits.forEach(habit => {
                if (!habit.days || habit.days.length !== days) {
                    habit.days = Array(days).fill(false);
                }
            });
            saveHabits();
            refreshUI();
        });

        userInput.addEventListener('change', function() {
            user = userInput.value.trim();
            habits = loadHabits();
            refreshUI();
        });

        habitTable.addEventListener('change', function(e) {
            if (e.target.matches('input[type="checkbox"]')) {
                const hIdx = parseInt(e.target.getAttribute('data-habit'));
                const dIdx = parseInt(e.target.getAttribute('data-day'));
                habits[hIdx].days[dIdx] = e.target.checked;
                saveHabits();
                updateStats();
            }
        });

        saveBtn.addEventListener('click', function() {
            saveProgressHistory();
        });

        // --- Initial Render ---
        window.addEventListener('DOMContentLoaded', function() {
            monthSelect.value = selectedMonth;
            userInput.value = user;
            habits = loadHabits();
            refreshUI();
        });
    </script>
    <!-- Bootstrap JS -->
        <script src="assets/js/bootstrap.bundle.min.js"></script>
</body>
</html>
